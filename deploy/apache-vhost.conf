<VirtualHost *:80>
    ServerName example.com
    ServerAlias www.example.com

    # Document root - point this to the frontend build folder (dist)
    DocumentRoot /www/wwwroot/example.com/dist

    <Directory /www/wwwroot/example.com/dist>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # SPA fallback: let .htaccess or these rules serve index.html for unknown routes
    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteBase /
        # If the request is not a file or directory, serve index.html
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ /index.html [L,QSA]
    </IfModule>

    # Proxy API requests to backend running on localhost:5000
    # Adjust path `/api` as needed to match your backend routes
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyPass /api http://127.0.0.1:5000/api
    ProxyPassReverse /api http://127.0.0.1:5000/api

    # Optional: forward websockets if your backend uses them
    ProxyPass /socket.io/ http://127.0.0.1:5000/socket.io/
    ProxyPassReverse /socket.io/ http://127.0.0.1:5000/socket.io/

    # Recommended headers
    RequestHeader set X-Forwarded-Proto expr=%{REQUEST_SCHEME}

    ErrorLog ${APACHE_LOG_DIR}/example.com-error.log
    CustomLog ${APACHE_LOG_DIR}/example.com-access.log combined
</VirtualHost>
